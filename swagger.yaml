openapi: 3.0.0
info:
  title: Gestor Financiero IA API
  version: 2.0.0
  description: |
    API avanzada con 20 caracter铆sticas de Inteligencia Artificial para gesti贸n financiera personal.
    
    ##  Caracter铆sticas Principales
    
    ###  PREDICCIN DE GASTOS (5 mejoras)
    1. Predicci贸n por categor铆a
    2. Predicci贸n mensual (30 d铆as)
    3. Detecci贸n de anomal铆as
    4. M煤ltiples modelos ML (ARIMA, Prophet, LSTM)
    5. An谩lisis de estacionalidad
    
    ###  ANLISIS ESTADSTICO (5 mejoras)
    6. Correlaciones entre categor铆as
    7. An谩lisis temporal (mes actual vs anterior)
    8. Clustering autom谩tico de gastos
    9. Detecci贸n de tendencias
    10. Identificaci贸n de outliers (IQR + Z-Score)
    
    ###  RECOMENDACIONES DE AHORRO (5 mejoras)
    11. Metas de ahorro (objetivos espec铆ficos)
    12. Tips personalizados (basados en patrones)
    13. Alertas de presupuesto (l铆mites mensuales)
    14. Gamificaci贸n (puntuaci贸n financiera)
    15. Reportes autom谩ticos (resumen semanal)
    
    ###  GRFICOS Y VISUALIZACIN (5 mejoras)
    16. Calendario de calor (Heatmap de gastos)
    17. Gr谩fico Sankey (Flujo de dinero)
    18. Dashboard interactivo (Panel con filtros)
    19. Comparativas (Mes vs mes anterior)
    20. Exportar como imagen (PNG/PDF)
    
    ##  Autenticaci贸n
    
    Todos los endpoints (excepto `/auth/token` y `/health`) requieren autenticaci贸n mediante JWT.
    
    **Paso 1:** Obtener token en `/api/v2/auth/token`
    
    **Paso 2:** Incluir token en headers:
    - `Authorization: Bearer {token}` o
    - `X-API-Key: {token}`

servers:
  - url: https://api-google-colab.onrender.com
    description: Servidor de producci贸n (Render)
  - url: http://localhost:5000
    description: Servidor de desarrollo local

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
  
  schemas:
    Expense:
      type: object
      required:
        - fecha
        - monto
        - categoria
      properties:
        fecha:
          type: string
          format: date
          example: "2024-12-15"
          description: "Fecha del gasto en formato YYYY-MM-DD"
        monto:
          type: number
          format: float
          example: 150.50
          description: "Monto del gasto en la moneda local (debe ser un n煤mero positivo)"
        categoria:
          type: string
          example: "Comida"
          description: "Categor铆a del gasto. Ejemplos: Comida, Transporte, Entretenimiento, Servicios, Salud, Educaci贸n, Compras, Otros"
        descripcion:
          type: string
          example: "Almuerzo en restaurante"
          description: "Descripci贸n opcional del gasto"
    
    ExpensesRequest:
      type: object
      properties:
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/Expense'
          description: |
            Lista de gastos para an谩lisis. OPCIONAL si se usa Firebase (se obtienen autom谩ticamente del usuario).
            
            **Formato del Array:**
            - Cada elemento es un objeto con: fecha (string YYYY-MM-DD), monto (number), categoria (string)
            - M铆nimo recomendado: 30 gastos para an谩lisis preciso
            - M谩ximo: sin l铆mite (se procesan todos)
            
            **Ejemplo de Array:**
            ```json
            {
              "expenses": [
                {"fecha": "2026-01-08", "monto": 85.50, "categoria": "Comida", "descripcion": "Almuerzo"},
                {"fecha": "2026-01-08", "monto": 35.00, "categoria": "Transporte"},
                {"fecha": "2026-01-07", "monto": 120.00, "categoria": "Entretenimiento"}
              ]
            }
            ```
      examples:
        con_expenses:
          summary: "Con array de expenses (modo standalone)"
          value:
            expenses:
              - fecha: "2026-01-08"
                monto: 85.50
                categoria: "Comida"
                descripcion: "Almuerzo en restaurante"
              - fecha: "2026-01-08"
                monto: 35.00
                categoria: "Transporte"
                descripcion: "Uber a la oficina"
              - fecha: "2026-01-07"
                monto: 120.00
                categoria: "Entretenimiento"
                descripcion: "Cine con amigos"
              - fecha: "2026-01-07"
                monto: 450.00
                categoria: "Compras"
                descripcion: "Ropa nueva"
              - fecha: "2026-01-06"
                monto: 92.30
                categoria: "Comida"
                descripcion: "Cena familiar"
        sin_expenses:
          summary: "Sin array (modo Firebase)"
          description: "Dejar vac铆o para obtener gastos autom谩ticamente de Firebase usando el user_id del token"
          value: {}
    
    TokenRequest:
      type: object
      properties:
        user_id:
          type: string
          example: "abc123xyz789"
          description: "ID del usuario en Firebase. Si no se proporciona, se usar谩 'default_user'"
          default: "default_user"
    
    TokenResponse:
      type: object
      properties:
        status:
          type: string
          example: "success"
        token:
          type: string
          example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
        expires_in:
          type: integer
          example: 86400
        message:
          type: string
        instrucciones:
          type: string
    
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Token inv谩lido o expirado"

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:
  /api/v2/auth/token:
    post:
      tags:
        - Autenticaci贸n
      summary: Generar token JWT
      description: Genera un nuevo token JWT para acceder a los endpoints protegidos
      security: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
      responses:
        '200':
          description: Token generado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                status: "success"
                token: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYWJjMTIzeHl6Nzg5IiwidG9rZW5faWQiOiI1NTcyZWY4YS1jMmIzLTQxZDUtOTZhMS04YzRkZjk3NDU2MTIiLCJpYXQiOjE3MDUxNTg2MDAsImV4cCI6MTcwNTI0NTAwMH0.xYz123ABC..."
                expires_in: 86400
                message: "Token generado para abc123xyz789. V谩lido por 24 horas"
                instrucciones: "Usar en headers: Authorization: Bearer <token> o X-API-Key: <token>"
                user_id: "abc123xyz789"

  /api/v2/predict-category:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: Predicci贸n por categor铆a
      description: |
        Predice gastos separados para cada categor铆a para los pr贸ximos 30 d铆as.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/predict-category`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** 
        - `expenses` (opcional): Array de gastos. Si se omite, se obtienen de Firebase usando el user_id del token.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Predicciones generadas exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  data:
                    type: object
              example:
                status: "success"
                message: "Predicci贸n por categor铆a generada exitosamente para los pr贸ximos 30 d铆as"
                data:
                  Comida:
                    predicciones:
                      - fecha: "2026-01-10"
                        monto: 85.50
                        dia_semana: "Viernes"
                      - fecha: "2026-01-11"
                        monto: 92.30
                        dia_semana: "S谩bado"
                      - fecha: "2026-01-12"
                        monto: 78.20
                        dia_semana: "Domingo"
                    total: 2556.00
                    promedio_diario: 85.20
                    dias: 30
                  Transporte:
                    predicciones:
                      - fecha: "2026-01-10"
                        monto: 35.00
                        dia_semana: "Viernes"
                      - fecha: "2026-01-11"
                        monto: 28.50
                        dia_semana: "S谩bado"
                      - fecha: "2026-01-12"
                        monto: 0.00
                        dia_semana: "Domingo"
                    total: 945.00
                    promedio_diario: 31.50
                    dias: 30
                  Entretenimiento:
                    predicciones:
                      - fecha: "2026-01-10"
                        monto: 45.00
                        dia_semana: "Viernes"
                      - fecha: "2026-01-11"
                        monto: 120.00
                        dia_semana: "S谩bado"
                    total: 750.00
                    promedio_diario: 25.00
                    dias: 30

  /api/v2/predict-monthly:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: Predicci贸n mensual (30 d铆as)
      description: |
        Predice gastos para los pr贸ximos 30 d铆as con intervalos de confianza.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/predict-monthly`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Predicci贸n mensual generada
          content:
            application/json:
              example:
                status: "success"
                message: "Predicci贸n mensual generada para los pr贸ximos 30 d铆as con intervalos de confianza"
                data:
                  diarias:
                    - fecha: "2026-01-10"
                      dia_semana: "Viernes"
                      semana: 1
                      prediccion: 165.50
                      min: 120.30
                      max: 210.70
                    - fecha: "2026-01-11"
                      dia_semana: "S谩bado"
                      semana: 1
                      prediccion: 240.80
                      min: 180.50
                      max: 301.10
                    - fecha: "2026-01-12"
                      dia_semana: "Domingo"
                      semana: 2
                      prediccion: 123.40
                      min: 85.20
                      max: 161.60
                    - fecha: "2026-01-13"
                      dia_semana: "Lunes"
                      semana: 2
                      prediccion: 145.20
                      min: 105.40
                      max: 185.00
                  total_mes: 4815.00
                  promedio_diario: 160.50
                  desviacion_estandar: 45.30
                  resumen_semanal:
                    1:
                      total: 1123.80
                      promedio_diario: 160.54
                      dias: 7
                    2:
                      total: 1089.60
                      promedio_diario: 155.66
                      dias: 7
                    3:
                      total: 1167.20
                      promedio_diario: 166.74
                      dias: 7
                    4:
                      total: 1434.40
                      promedio_diario: 159.38
                      dias: 9

  /api/v2/detect-anomalies:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: Detecci贸n de anomal铆as
      description: |
        Detecta gastos an贸malos usando Z-Score e Isolation Forest.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/detect-anomalies`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Anomal铆as detectadas
          content:
            application/json:
              example:
                status: "success"
                message: "An谩lisis de anomal铆as completado usando Z-Score e Isolation Forest"
                data:
                  cantidad: 4
                  total_gastos: 76
                  porcentaje: 5.26
                  anomalias:
                    - fecha: "2026-01-05"
                      monto: 850.00
                      categoria: "Compras"
                      descripcion: "Compra de electrodom茅stico"
                      metodo: "Z-Score"
                      razon: "Desviaci贸n 3.45 del promedio (promedio: 145.50, desv: 204.35)"
                      z_score: 3.45
                    - fecha: "2025-12-28"
                      monto: 1250.00
                      categoria: "Salud"
                      descripcion: "Consulta m茅dica especializada"
                      metodo: "Isolation Forest"
                      razon: "Gasto at铆pico detectado por ML"
                      anomaly_score: -0.42
                    - fecha: "2026-01-02"
                      monto: 680.00
                      categoria: "Entretenimiento"
                      descripcion: "Concierto"
                      metodo: "Z-Score + Isolation Forest"
                      razon: "Desviaci贸n 2.87 del promedio (promedio: 85.30, desv: 207.18)"
                      z_score: 2.87
                    - fecha: "2025-12-20"
                      monto: 925.00
                      categoria: "Servicios"
                      descripcion: "Reparaci贸n de veh铆culo"
                      metodo: "Z-Score"
                      razon: "Desviaci贸n 3.12 del promedio (promedio: 120.00, desv: 258.06)"
                      z_score: 3.12
                  estadisticas:
                    promedio_general: 145.50
                    mediana: 89.30
                    desviacion_estandar: 204.35

  /api/v2/compare-models:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: Comparaci贸n de modelos ML
      description: |
        Entrena y compara m煤ltiples modelos de Machine Learning (RandomForest, ARIMA, ExponentialSmoothing).
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/compare-models`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Comparaci贸n de modelos completada
          content:
            application/json:
              example:
                status: "success"
                message: "Comparaci贸n de modelos completada. Se entrenaron y evaluaron 3 modelos diferentes"
                data:
                  modelos: ["RandomForest", "ARIMA", "ExponentialSmoothing"]
                  resultados:
                    RandomForest:
                      mae: 15.32
                      r2: 0.8756
                      rmse: 19.85
                      modelo: "RandomForest"
                      parametros:
                        n_estimators: 100
                        max_depth: 10
                      descripcion: "Modelo de ensamble que usa m煤ltiples 谩rboles de decisi贸n"
                    ARIMA:
                      mae: 18.45
                      r2: 0.8234
                      rmse: 23.10
                      modelo: "ARIMA"
                      parametros:
                        order: [2, 1, 2]
                      descripcion: "Modelo de series de tiempo autorregresivo integrado de media m贸vil"
                    ExponentialSmoothing:
                      mae: 21.78
                      r2: 0.7892
                      rmse: 27.34
                      modelo: "ExponentialSmoothing"
                      parametros:
                        trend: "add"
                        seasonal: "add"
                        seasonal_periods: 7
                      descripcion: "Modelo de suavizado exponencial con tendencia y estacionalidad"
                  mejor: "RandomForest"
                  mejor_r2: 0.8756
                  mejor_mae: 15.32
                  recomendacion: "Se recomienda usar RandomForest por su mejor precisi贸n (R虏 = 0.8756)"
                  metricas_explicacion:
                    mae: "Error Absoluto Medio - menor es mejor (diferencia promedio entre predicci贸n y real)"
                    r2: "Coeficiente de determinaci贸n - m谩s cercano a 1 es mejor (qu茅 tan bien explica el modelo)"
                    rmse: "Ra铆z del Error Cuadr谩tico Medio - menor es mejor (penaliza errores grandes)"

  /api/v2/seasonality:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: An谩lisis de estacionalidad
      description: |
        Detecta patrones semanales y mensuales en los gastos.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/seasonality`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: An谩lisis de estacionalidad completado

  /api/v2/analysis-complete:
    post:
      tags:
        -  Predicci贸n de Gastos
      summary: An谩lisis completo de predicci贸n
      description: |
        Ejecuta todas las 5 mejoras de predicci贸n en un solo endpoint.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/analysis-complete`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: An谩lisis completo generado
          content:
            application/json:
              example:
                status: "success"
                data:
                  prediccion_categoria: {}
                  prediccion_mensual: {}
                  anomalias: {}
                  comparacion_modelos: {}
                  estacionalidad: {}
                  timestamp: "2024-12-15T10:30:00"

  /api/v2/stat/correlations:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: Correlaciones entre categor铆as
      description: |
        Analiza correlaciones entre diferentes categor铆as de gastos.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/correlations`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Correlaciones calculadas

  /api/v2/stat/temporal-comparison:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: Comparaci贸n temporal
      description: |
        Compara gastos del mes actual vs mes anterior.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/temporal-comparison`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Comparaci贸n temporal generada

  /api/v2/stat/clustering:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: Clustering de gastos
      description: |
        Agrupa autom谩ticamente gastos similares usando K-Means.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/clustering`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `n_clusters` (opcional): N煤mero de clusters (default: 3)
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                n_clusters:
                  type: integer
                  example: 3
                  description: "N煤mero de grupos a identificar (default: 3). Recomendado: 3-5 clusters"
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
                  description: "Array de gastos (opcional si se usa Firebase)"
            examples:
              modo_firebase_3_clusters:
                summary: "Firebase con 3 clusters (default)"
                value:
                  n_clusters: 3
              modo_firebase_5_clusters:
                summary: "Firebase con 5 clusters"
                description: "Usa m谩s clusters para identificar patrones m谩s espec铆ficos"
                value:
                  n_clusters: 5
              modo_manual:
                summary: "Con array de expenses y 4 clusters"
                value:
                  n_clusters: 4
                  expenses:
                    - fecha: "2026-01-08"
                      monto: 45.00
                      categoria: "Comida"
                    - fecha: "2026-01-08"
                      monto: 35.00
                      categoria: "Transporte"
                    - fecha: "2026-01-07"
                      monto: 180.00
                      categoria: "Entretenimiento"
                    - fecha: "2026-01-06"
                      monto: 850.00
                      categoria: "Compras"
      responses:
        '200':
          description: Clustering completado
          content:
            application/json:
              schema:
                type: object
              example:
                status: "success"
                message: "Clustering completado. Se identificaron 3 grupos de gastos con patrones similares"
                data:
                  n_clusters: 3
                  clusters:
                    0:
                      nombre: "Gastos Peque帽os Diarios"
                      descripcion: "Gastos frecuentes de bajo monto"
                      cantidad: 28
                      promedio_monto: 45.30
                      categorias_principales:
                        - "Comida"
                        - "Transporte"
                      ejemplos:
                        - fecha: "2026-01-08"
                          monto: 42.50
                          categoria: "Comida"
                        - fecha: "2026-01-07"
                          monto: 35.00
                          categoria: "Transporte"
                        - fecha: "2026-01-06"
                          monto: 58.20
                          categoria: "Comida"
                    1:
                      nombre: "Gastos Medianos Semanales"
                      descripcion: "Gastos ocasionales de monto moderado"
                      cantidad: 15
                      promedio_monto: 185.60
                      categorias_principales:
                        - "Entretenimiento"
                        - "Compras"
                      ejemplos:
                        - fecha: "2026-01-05"
                          monto: 180.00
                          categoria: "Entretenimiento"
                        - fecha: "2026-01-03"
                          monto: 215.30
                          categoria: "Compras"
                    2:
                      nombre: "Gastos Grandes Mensuales"
                      descripcion: "Gastos importantes poco frecuentes"
                      cantidad: 4
                      promedio_monto: 875.50
                      categorias_principales:
                        - "Servicios"
                        - "Salud"
                      ejemplos:
                        - fecha: "2026-01-02"
                          monto: 850.00
                          categoria: "Servicios"
                        - fecha: "2025-12-28"
                          monto: 1250.00
                          categoria: "Salud"
                  interpretacion: "Tus gastos se agrupan en 3 patrones: gastos diarios peque帽os (~45), gastos semanales medianos (~185), y gastos mensuales grandes (~875)"

  /api/v2/stat/trends:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: Detecci贸n de tendencias
      description: |
        Detecta tendencias en los patrones de gasto.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/trends`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Tendencias detectadas

  /api/v2/stat/outliers:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: Detecci贸n de outliers
      description: |
        Detecta gastos at铆picos usando IQR y Z-Score.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/outliers`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Outliers detectados

  /api/v2/stat/complete:
    post:
      tags:
        -  An谩lisis Estad铆stico
      summary: An谩lisis estad铆stico completo
      description: |
        Ejecuta todas las 5 mejoras de an谩lisis estad铆stico en un solo endpoint.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/stat/complete`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: An谩lisis completo generado

  /api/v2/savings/goals:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: Metas de ahorro
      description: |
        Calcula metas de ahorro personalizadas basadas en objetivos espec铆ficos.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/goals`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `goal_name`: Nombre de la meta (default: "Meta general")
        - `target_amount`: Monto objetivo (default: 5000)
        - `months`: Meses para alcanzar la meta (default: 12)
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                goal_name:
                  type: string
                  example: "Vacaciones"
                  description: "Nombre descriptivo de la meta de ahorro"
                target_amount:
                  type: number
                  example: 5000
                  description: "Monto objetivo a ahorrar (en tu moneda local)"
                months:
                  type: integer
                  example: 12
                  description: "Plazo en meses para alcanzar la meta"
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
                  description: "Array de gastos (opcional si se usa Firebase)"
            examples:
              vacaciones_europa:
                summary: "Meta: Vacaciones en Europa"
                value:
                  goal_name: "Vacaciones en Europa"
                  target_amount: 8000
                  months: 12
              auto_usado:
                summary: "Meta: Comprar auto usado"
                value:
                  goal_name: "Auto usado"
                  target_amount: 50000
                  months: 24
              fondo_emergencia:
                summary: "Meta: Fondo de emergencia"
                description: "3 meses de gastos como fondo de emergencia"
                value:
                  goal_name: "Fondo de emergencia"
                  target_amount: 15000
                  months: 10
              curso_online:
                summary: "Meta: Curso de programaci贸n"
                value:
                  goal_name: "Curso online de programaci贸n"
                  target_amount: 1500
                  months: 3
      responses:
        '200':
          description: Metas calculadas
          content:
            application/json:
              schema:
                type: object
              example:
                status: "success"
                message: "Meta de ahorro calculada exitosamente"
                data:
                  meta:
                    nombre: "Vacaciones en Europa"
                    monto_objetivo: 8000.00
                    meses: 12
                    ahorro_mensual_requerido: 666.67
                    ahorro_semanal_requerido: 153.85
                    ahorro_diario_requerido: 21.98
                  analisis_actual:
                    gasto_promedio_mensual: 4815.00
                    gasto_promedio_diario: 160.50
                    ingreso_estimado: 6000.00
                    capacidad_ahorro_actual: 1185.00
                  viabilidad:
                    es_alcanzable: true
                    porcentaje_ingreso: 11.11
                    excedente_mensual: 518.33
                    confianza: "Alta"
                    mensaje: "Tu meta es alcanzable. Necesitas ahorrar $666.67 mensuales y actualmente tienes capacidad de $1,185"
                  plan_accion:
                    - accion: "Reducir gastos en Entretenimiento en 15%"
                      ahorro_estimado: 112.50
                    - accion: "Optimizar gastos de Comida preparando m谩s en casa"
                      ahorro_estimado: 350.00
                    - accion: "Usar transporte p煤blico 3 d铆as a la semana"
                      ahorro_estimado: 180.00
                  cronograma:
                    - mes: 1
                      ahorro_acumulado: 666.67
                      porcentaje_meta: 8.33
                    - mes: 6
                      ahorro_acumulado: 4000.00
                      porcentaje_meta: 50.00
                    - mes: 12
                      ahorro_acumulado: 8000.00
                      porcentaje_meta: 100.00

  /api/v2/savings/tips:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: Tips personalizados
      description: |
        Genera tips de ahorro personalizados basados en patrones de gasto.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/tips`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Tips generados
          content:
            application/json:
              schema:
                type: object
              example:
                status: "success"
                message: "Se generaron 8 recomendaciones personalizadas basadas en tu patr贸n de gastos"
                data:
                  tips:
                    - id: 1
                      categoria: "Comida"
                      tipo: "Reducci贸n de Gastos"
                      prioridad: "Alta"
                      titulo: "Reduce gastos en comidas fuera de casa"
                      descripcion: "Gastas un promedio de $85.20 diarios en comida. Preparando almuerzos 3 veces por semana podr铆as ahorrar ~$350 mensuales"
                      ahorro_estimado: 350.00
                      dificultad: "Media"
                      impacto: "Alto"
                      pasos:
                        - "Planifica men煤s semanales los domingos"
                        - "Compra ingredientes en bulk"
                        - "Prepara comidas en lotes los fines de semana"
                    - id: 2
                      categoria: "Transporte"
                      tipo: "Optimizaci贸n"
                      prioridad: "Media"
                      titulo: "Combina transporte p煤blico con Uber"
                      descripcion: "Usas Uber/taxi ~20 veces al mes ($35 promedio). Usa transporte p煤blico para distancias cortas"
                      ahorro_estimado: 280.00
                      dificultad: "Baja"
                      impacto: "Medio"
                      pasos:
                        - "Descarga apps de transporte p煤blico"
                        - "Identifica rutas frecuentes"
                        - "Compra abono mensual si aplica"
                    - id: 3
                      categoria: "Entretenimiento"
                      tipo: "Sustituci贸n"
                      prioridad: "Baja"
                      titulo: "Aprovecha alternativas gratuitas de entretenimiento"
                      descripcion: "Gastas $750 mensuales en entretenimiento. Considera eventos gratuitos, parques, museos con entrada libre"
                      ahorro_estimado: 225.00
                      dificultad: "Baja"
                      impacto: "Medio"
                      pasos:
                        - "Busca eventos gratuitos en tu ciudad"
                        - "Aprovecha d铆as de entrada libre a museos"
                        - "Organiza actividades al aire libre"
                    - id: 4
                      categoria: "Servicios"
                      tipo: "Revisi贸n de Suscripciones"
                      prioridad: "Alta"
                      titulo: "Revisa y cancela suscripciones no utilizadas"
                      descripcion: "Se detectaron gastos recurrentes. Revisa Netflix, Spotify, gym y cancela los que no uses frecuentemente"
                      ahorro_estimado: 180.00
                      dificultad: "Muy Baja"
                      impacto: "Medio"
                      pasos:
                        - "Lista todas tus suscripciones activas"
                        - "Eval煤a uso real vs costo mensual"
                        - "Cancela las que uses menos de 2 veces al mes"
                  resumen:
                    ahorro_potencial_mensual: 1035.00
                    ahorro_potencial_anual: 12420.00
                    tips_alta_prioridad: 2
                    tips_faciles: 2

  /api/v2/savings/budget-alerts:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: Alertas de presupuesto
      description: |
        Genera alertas cuando se acerca o supera el presupuesto mensual.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/budget-alerts`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `monthly_budget`: Presupuesto mensual (default: 3000)
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                monthly_budget:
                  type: number
                  example: 3000
                  description: "Presupuesto mensual total en tu moneda local. La API comparar谩 tus gastos actuales contra este l铆mite"
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
                  description: "Array de gastos (opcional si se usa Firebase)"
            examples:
              presupuesto_bajo:
                summary: "Presupuesto ajustado ($3,000)"
                description: "Para personas con presupuesto limitado"
                value:
                  monthly_budget: 3000
              presupuesto_medio:
                summary: "Presupuesto medio ($5,000)"
                value:
                  monthly_budget: 5000
              presupuesto_alto:
                summary: "Presupuesto holgado ($8,000)"
                description: "Para mayores ingresos"
                value:
                  monthly_budget: 8000
      responses:
        '200':
          description: Alertas generadas
          content:
            application/json:
              schema:
                type: object
              example:
                status: "success"
                message: "An谩lisis de presupuesto completado"
                data:
                  presupuesto_mensual: 5000.00
                  gasto_actual: 4815.00
                  gasto_porcentaje: 96.30
                  presupuesto_restante: 185.00
                  dias_restantes_mes: 22
                  promedio_diario_disponible: 8.41
                  alerta:
                    nivel: "Cr铆tico"
                    mensaje: "隆ALERTA! Has gastado el 96.3% de tu presupuesto mensual con 22 d铆as restantes"
                    color: "#FF4444"
                    recomendacion: "Reduce gastos inmediatamente. Solo tienes $8.41 disponibles por d铆a"
                  proyeccion:
                    gasto_proyectado_fin_mes: 8346.00
                    sobregasto_estimado: 3346.00
                    probabilidad_sobregiro: 0.92
                  alertas_categoria:
                    - categoria: "Comida"
                      presupuesto: 1500.00
                      gastado: 2556.00
                      porcentaje: 170.40
                      estado: "Excedido"
                      exceso: 1056.00
                    - categoria: "Entretenimiento"
                      presupuesto: 500.00
                      gastado: 750.00
                      porcentaje: 150.00
                      estado: "Excedido"
                      exceso: 250.00
                    - categoria: "Transporte"
                      presupuesto: 800.00
                      gastado: 945.00
                      porcentaje: 118.13
                      estado: "Excedido"
                      exceso: 145.00
                  acciones_sugeridas:
                    - "Pausa gastos no esenciales por el resto del mes"
                    - "Enfoca solo en necesidades b谩sicas"
                    - "Considera fuentes de ingreso adicionales"
                    - "Revisa y ajusta presupuesto para el pr贸ximo mes"

  /api/v2/savings/health-score:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: Puntuaci贸n financiera
      description: |
        Calcula una puntuaci贸n de salud financiera (0-100).
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/health-score`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `monthly_budget`: Presupuesto mensual (default: 3000)
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                monthly_budget:
                  type: number
                  example: 3000
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
      responses:
        '200':
          description: Puntuaci贸n calculada

  /api/v2/savings/weekly-report:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: Reporte semanal
      description: |
        Genera un resumen autom谩tico de gastos de la 煤ltima semana.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/weekly-report`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Reporte generado
          content:
            application/json:
              schema:
                type: object
              example:
                status: "success"
                message: "Reporte semanal generado para el periodo 02-Ene-2026 al 08-Ene-2026"
                data:
                  periodo:
                    inicio: "2026-01-02"
                    fin: "2026-01-08"
                    dias: 7
                  resumen:
                    total_gastado: 1123.80
                    promedio_diario: 160.54
                    cantidad_transacciones: 18
                    dia_mayor_gasto: "2026-01-05"
                    monto_mayor_gasto: 280.00
                  comparacion_semana_anterior:
                    semana_anterior: 945.30
                    diferencia: 178.50
                    porcentaje_cambio: 18.88
                    tendencia: "Aumento"
                    mensaje: "Gastaste $178.50 m谩s que la semana anterior (+18.88%)"
                  por_categoria:
                    - categoria: "Comida"
                      total: 597.40
                      porcentaje: 53.15
                      transacciones: 9
                      promedio_transaccion: 66.38
                      comparacion_anterior: 12.50
                      tendencia: "Aumento"
                    - categoria: "Transporte"
                      total: 245.00
                      porcentaje: 21.80
                      transacciones: 5
                      promedio_transaccion: 49.00
                      comparacion_anterior: -8.30
                      tendencia: "Disminuci贸n"
                    - categoria: "Entretenimiento"
                      total: 281.40
                      porcentaje: 25.05
                      transacciones: 4
                      promedio_transaccion: 70.35
                      comparacion_anterior: 45.80
                      tendencia: "Aumento"
                  gastos_por_dia:
                    - fecha: "2026-01-02"
                      total: 95.50
                      transacciones: 2
                      dia_semana: "Viernes"
                    - fecha: "2026-01-03"
                      total: 215.30
                      transacciones: 4
                      dia_semana: "S谩bado"
                    - fecha: "2026-01-04"
                      total: 123.40
                      transacciones: 3
                      dia_semana: "Domingo"
                    - fecha: "2026-01-05"
                      total: 280.00
                      transacciones: 2
                      dia_semana: "Lunes"
                    - fecha: "2026-01-06"
                      total: 145.20
                      transacciones: 3
                      dia_semana: "Martes"
                    - fecha: "2026-01-07"
                      total: 132.60
                      transacciones: 2
                      dia_semana: "Mi茅rcoles"
                    - fecha: "2026-01-08"
                      total: 131.80
                      transacciones: 2
                      dia_semana: "Jueves"
                  insights:
                    - tipo: "Patr贸n"
                      titulo: "Gastos mayores los fines de semana"
                      descripcion: "Tus gastos de s谩bado y domingo son 45% m谩s altos que entre semana"
                    - tipo: "Alerta"
                      titulo: "Aumento en categor铆a Entretenimiento"
                      descripcion: "Tus gastos en entretenimiento subieron 45.8% vs semana anterior"
                    - tipo: "Positivo"
                      titulo: "Reducci贸n en Transporte"
                      descripcion: "Lograste reducir gastos de transporte en $8.30 esta semana"
                  recomendaciones:
                    - "Intenta mantener el control de gastos en Comida durante la pr贸xima semana"
                    - "Considera reducir salidas de entretenimiento costosas"
                    - "Contin煤a optimizando gastos de transporte"
                  proyeccion_mes:
                    semanas_restantes: 3
                    proyeccion_total: 4495.20
                    presupuesto_mensual: 5000.00
                    estado: "En L铆mite"
                    mensaje: "Si contin煤as a este ritmo, terminar谩s el mes en $4,495.20 (89.9% del presupuesto)"

  /api/v2/savings/complete:
    post:
      tags:
        -  Recomendaciones de Ahorro
      summary: An谩lisis completo de ahorro
      description: |
        Ejecuta todas las 5 mejoras de recomendaciones de ahorro en un solo endpoint.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/savings/complete`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `goal_name`, `target_amount`, `months`, `monthly_budget`
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                goal_name:
                  type: string
                target_amount:
                  type: number
                months:
                  type: integer
                monthly_budget:
                  type: number
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
      responses:
        '200':
          description: An谩lisis completo generado

  /api/v2/charts/heatmap:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Calendario de calor
      description: |
        Genera un calendario de calor (heatmap) de gastos.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/heatmap`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Heatmap generado

  /api/v2/charts/sankey:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Diagrama Sankey
      description: |
        Genera un diagrama Sankey del flujo de dinero entre categor铆as.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/sankey`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Diagrama Sankey generado

  /api/v2/charts/dashboard:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Dashboard interactivo
      description: |
        Genera un dashboard interactivo con m煤ltiples gr谩ficos.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/dashboard`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Dashboard generado

  /api/v2/charts/comparison:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Comparaci贸n mensual
      description: |
        Genera gr谩ficos comparativos mes vs mes anterior.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/comparison`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Comparaci贸n generada

  /api/v2/charts/export:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Exportar gr谩ficos
      description: |
        Exporta gr谩ficos como im谩genes en formato JSON o BASE64.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/export`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `format`: "json" o "base64" (default: "json")
        - `expenses` (opcional): Array de gastos
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                format:
                  type: string
                  enum: ["json", "base64"]
                  example: "json"
                expenses:
                  type: array
                  items:
                    $ref: '#/components/schemas/Expense'
      responses:
        '200':
          description: Gr谩ficos exportados

  /api/v2/charts/complete:
    post:
      tags:
        -  Gr谩ficos y Visualizaci贸n
      summary: Todos los gr谩ficos
      description: |
        Genera todos los 5 tipos de gr谩ficos en un solo endpoint.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/charts/complete`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** Ninguno (usa datos de Firebase) o `expenses` array
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExpensesRequest'
      responses:
        '200':
          description: Todos los gr谩ficos generados

  /api/v2/firebase/usuarios:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener todos los usuarios
      description: |
        Obtiene todos los usuarios registrados en Firebase (colecci贸n users).
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/usuarios`
        
        ** Requiere:** Token de autenticaci贸n
      responses:
        '200':
          description: Usuarios obtenidos exitosamente
          content:
            application/json:
              example:
                status: "success"
                total: 5
                message: "Se encontraron 5 usuarios registrados en Firebase"
                data:
                  - id: "abc123xyz789"
                    nombre: "Juan P茅rez"
                    email: "juan.perez@example.com"
                    fecha_registro: "2025-11-15T10:30:00Z"
                    total_gastos: 1250.50
                  - id: "def456uvw012"
                    nombre: "Mar铆a Garc铆a"
                    email: "maria.garcia@example.com"
                    fecha_registro: "2025-10-20T14:20:00Z"
                    total_gastos: 3420.75
                  - id: "ghi789rst345"
                    nombre: "Carlos L贸pez"
                    email: "carlos.lopez@example.com"
                    fecha_registro: "2025-12-01T09:15:00Z"
                    total_gastos: 890.30
                  - id: "jkl012mno678"
                    nombre: "Ana Mart铆nez"
                    email: "ana.martinez@example.com"
                    fecha_registro: "2025-11-28T16:45:00Z"
                    total_gastos: 2150.90
                  - id: "pqr345stu901"
                    nombre: "Luis Rodr铆guez"
                    email: "luis.rodriguez@example.com"
                    fecha_registro: "2025-12-10T11:00:00Z"
                    total_gastos: 1780.25

  /api/v2/firebase/usuarios/{usuario_id}:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener usuario espec铆fico
      description: |
        Obtiene informaci贸n de un usuario espec铆fico desde Firebase.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/usuarios/{usuario_id}`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `usuario_id` (path): ID del usuario en Firebase
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Usuario obtenido exitosamente
          content:
            application/json:
              example:
                status: "success"
                message: "Usuario encontrado exitosamente"
                data:
                  id: "abc123xyz789"
                  nombre: "Juan P茅rez"
                  email: "juan.perez@example.com"
                  telefono: "+52 55 1234 5678"
                  fecha_registro: "2025-11-15T10:30:00Z"
                  presupuesto_mensual: 5000.00
                  total_gastos: 1250.50
                  cantidad_gastos: 47
                  ultima_actividad: "2026-01-08T18:45:00Z"
                  categorias_favoritas:
                    - "Comida"
                    - "Transporte"
                    - "Entretenimiento"

  /api/v2/firebase/users/{usuario_id}/gastos:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener gastos del usuario
      description: |
        Obtiene todos los gastos registrados de un usuario desde Firebase.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/gastos`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:** 
        - `usuario_id` (path): ID del usuario en Firebase
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gastos obtenidos exitosamente
    
    post:
      tags:
        -  Firebase Integration
      summary: Crear nuevo gasto
      description: |
        Crea un nuevo gasto en Firebase para el usuario especificado.
        
        ** Endpoint:** `POST https://tu-api.com/api/v2/firebase/users/{usuario_id}/gastos`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `usuario_id` (path): ID del usuario
        - Body: datos del gasto (categoria, cantidad, fecha, descripcion)
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - categoria
                - cantidad
              properties:
                categoria:
                  type: string
                  example: "Comida"
                  description: "Categor铆a del gasto. Valores v谩lidos: Comida, Transporte, Entretenimiento, Servicios, Salud, Educaci贸n, Compras, Vivienda, Otros"
                cantidad:
                  type: number
                  example: 150.50
                  description: "Monto del gasto (debe ser un n煤mero positivo mayor a 0)"
                descripcion:
                  type: string
                  example: "Almuerzo en restaurante italiano"
                  description: "Descripci贸n detallada del gasto (opcional pero recomendado)"
                fecha:
                  type: string
                  format: date-time
                  example: "2026-01-09T14:30:00Z"
                  description: "Fecha y hora del gasto en formato ISO 8601. Si no se proporciona, se usar谩 la fecha actual"
            examples:
              comida:
                value:
                  categoria: "Comida"
                  cantidad: 150.50
                  descripcion: "Almuerzo en restaurante italiano"
                  fecha: "2026-01-09T14:30:00Z"
              transporte:
                value:
                  categoria: "Transporte"
                  cantidad: 35.00
                  descripcion: "Uber del trabajo a casa"
                  fecha: "2026-01-09T19:15:00Z"
              entretenimiento:
                value:
                  categoria: "Entretenimiento"
                  cantidad: 280.00
                  descripcion: "Cine IMAX con palomitas y bebidas"
                  fecha: "2026-01-08T21:00:00Z"
      responses:
        '201':
          description: Gasto creado exitosamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  gasto_id:
                    type: string
                  data:
                    type: object
              example:
                status: "success"
                message: "Gasto registrado exitosamente en Firebase"
                gasto_id: "gasto_abc123xyz789_20260109_143000"
                data:
                  id: "gasto_abc123xyz789_20260109_143000"
                  categoria: "Comida"
                  cantidad: 150.50
                  descripcion: "Almuerzo en restaurante italiano"
                  fecha: "2026-01-09T14:30:00Z"
                  usuario_id: "abc123xyz789"
                  timestamp: "2026-01-09T14:30:15.234Z"
        '400':
          description: Error en los datos enviados
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  error:
                    type: string
              example:
                status: "error"
                error: "La cantidad debe ser un n煤mero positivo mayor a 0"

  /api/v2/firebase/users/{usuario_id}/asesor-financiero:
    get:
      tags:
        -  Asesor Financiero IA
      summary: An谩lisis completo con IA
      description: |
        Devuelve an谩lisis integral del usuario con IA incluyendo:
        - Predicciones de gastos futuros (30 d铆as)
        - An谩lisis estad铆stico completo
        - Recomendaciones personalizadas de ahorro
        - Datos para gr谩ficos
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/asesor-financiero`
        
        ** Requiere:** Token de autenticaci贸n
        
        ** Par谩metros:**
        - `usuario_id` (path): ID del usuario en Firebase
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: An谩lisis completo generado

  /api/v2/firebase/users/{usuario_id}/predicciones:
    get:
      tags:
        -  Asesor Financiero IA
      summary: Predicciones para usuario
      description: |
        Obtiene todas las predicciones de gastos para un usuario espec铆fico.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/predicciones`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Predicciones generadas

  /api/v2/firebase/users/{usuario_id}/analisis:
    get:
      tags:
        -  Asesor Financiero IA
      summary: An谩lisis estad铆stico para usuario
      description: |
        Obtiene an谩lisis estad铆stico completo para un usuario espec铆fico.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/analisis`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: An谩lisis generado

  /api/v2/firebase/users/{usuario_id}/recomendaciones:
    get:
      tags:
        -  Asesor Financiero IA
      summary: Recomendaciones para usuario
      description: |
        Obtiene recomendaciones personalizadas de ahorro para un usuario.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/recomendaciones`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Recomendaciones generadas

  /api/v2/firebase/users/{usuario_id}/graficos:
    get:
      tags:
        -  Asesor Financiero IA
      summary: Gr谩ficos para usuario
      description: |
        Genera todos los gr谩ficos para un usuario espec铆fico.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/graficos`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gr谩ficos generados

  /api/v2/firebase/users/{usuario_id}/score:
    get:
      tags:
        -  Asesor Financiero IA
      summary: Puntuaci贸n financiera del usuario
      description: |
        Calcula la puntuaci贸n de salud financiera del usuario (0-100).
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/score`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Puntuaci贸n calculada

  /api/v2/firebase/users/{usuario_id}/gastos-procesados:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener gastos procesados
      description: |
        Obtiene gastos procesados y transformados para an谩lisis.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/gastos-procesados`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gastos procesados obtenidos

  /api/v2/firebase/users/{usuario_id}/gastos-ids:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener IDs de gastos
      description: |
        Obtiene solo los IDs de los gastos del usuario.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/users/{usuario_id}/gastos-ids`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: IDs de gastos obtenidos

  /api/v2/firebase/debug:
    get:
      tags:
        -  Debug & Utilidades
      summary: Debug de Firebase
      description: |
        Endpoint para debuguear la conexi贸n con Firebase.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/firebase/debug`
        
        ** Requiere:** Token de autenticaci贸n (opcional para debug)
      security: []
      responses:
        '200':
          description: Informaci贸n de debug

  # ===== NUEVOS ENDPOINTS CON SOPORTE DE CATEGORA =====
  
  /api/v2/users/{usuario_id}/predict-category:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Predicci贸n de categor铆a (filtrada)
      description: |
        Predicci贸n de gastos por categor铆a espec铆fica. Par谩metro opcional para filtrar por categor铆a.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/users/{usuario_id}/predict-category?category=Comida`
        
        ** Requiere:** Token de autenticaci贸n
        
        **Par谩metros:**
        - `usuario_id` (path): ID del usuario
        - `category` (query): Categor铆a espec铆fica a analizar (opcional)
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          description: ID 煤nico del usuario
        - name: category
          in: query
          required: false
          schema:
            type: string
            example: "Comida"
          description: "Categor铆a espec铆fica para filtrar (ej: Comida, Transporte, Entretenimiento)"
      responses:
        '200':
          description: Predicci贸n exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  usuario_id:
                    type: string
                  categoria:
                    type: string
                    example: "Comida"
                  data:
                    type: object
                    description: "Datos de predicci贸n por categor铆a"
        '400':
          description: Sin datos disponibles
        '500':
          description: Error en la predicci贸n

  /api/v2/users/{usuario_id}/predict-monthly:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Predicci贸n mensual (filtrada)
      description: |
        Predicci贸n de gastos mensuales (30 d铆as). Par谩metro opcional para filtrar por categor铆a.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/users/{usuario_id}/predict-monthly?category=Comida`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          description: ID 煤nico del usuario
        - name: category
          in: query
          required: false
          schema:
            type: string
            example: "Comida"
          description: "Categor铆a espec铆fica para filtrar"
      responses:
        '200':
          description: Predicci贸n mensual exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  usuario_id:
                    type: string
                  categoria:
                    type: string
                  data:
                    type: object
                    description: "Datos de predicci贸n mensual"
        '400':
          description: Sin datos disponibles

  /api/v2/users/{usuario_id}/detect-anomalies:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Detecci贸n de anomal铆as (filtrada)
      description: |
        Detecta gastos an贸malos o inusuales. Par谩metro opcional para filtrar por categor铆a.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/users/{usuario_id}/detect-anomalies?category=Comida`
        
        ** Requiere:** Token de autenticaci贸n
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          description: ID 煤nico del usuario
        - name: category
          in: query
          required: false
          schema:
            type: string
            example: "Comida"
          description: "Categor铆a espec铆fica para filtrar"
      responses:
        '200':
          description: An谩lisis de anomal铆as exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  usuario_id:
                    type: string
                  categoria:
                    type: string
                  data:
                    type: object
                    description: "Datos de anomal铆as detectadas"
        '400':
          description: Sin datos disponibles

  /api/v2/users/{usuario_id}/analysis-complete:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: An谩lisis completo personalizado
      description: |
        An谩lisis completo que incluye: predicci贸n por categor铆a, predicci贸n mensual, 
        detecci贸n de anomal铆as, comparaci贸n de modelos y an谩lisis de estacionalidad.
        Par谩metro opcional para filtrar por categor铆a.
        
        ** Endpoint:** `GET https://tu-api.com/api/v2/users/{usuario_id}/analysis-complete?category=Comida`
        
        ** Requiere:** Token de autenticaci贸n
        
        **Incluye:**
        1. Predicci贸n de gastos por categor铆a
        2. Predicci贸n mensual de gastos
        3. Detecci贸n de anomal铆as
        4. Comparaci贸n de modelos (ARIMA, Prophet, LSTM)
        5. An谩lisis de estacionalidad
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          description: ID 煤nico del usuario
        - name: category
          in: query
          required: false
          schema:
            type: string
            example: "Comida"
          description: "Categor铆a espec铆fica para filtrar an谩lisis completo"
      responses:
        '200':
          description: An谩lisis completo exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  usuario_id:
                    type: string
                  categoria:
                    type: string
                  data:
                    type: object
                    properties:
                      prediccion_categoria:
                        type: object
                      prediccion_mensual:
                        type: object
                      anomalias:
                        type: object
                      comparacion_modelos:
                        type: object
                      estacionalidad:
                        type: object
                      timestamp:
                        type: string
                    description: "An谩lisis completo con todas las predicciones"
        '400':
          description: Sin datos disponibles para la categor铆a especificada
        '500':
          description: Error en el an谩lisis
