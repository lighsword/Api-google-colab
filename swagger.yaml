openapi: 3.0.0
info:
  title: Gestor Financiero IA API
  version: 2.0.0
  description: |
    API avanzada con 20 caracter铆sticas de Inteligencia Artificial para gesti贸n financiera personal.
    
    ##  Caracter铆sticas Principales
    
    ###  PREDICCIN DE GASTOS (5 mejoras)
    1. Predicci贸n por categor铆a
    2. Predicci贸n mensual (30 d铆as)
    3. Detecci贸n de anomal铆as
    4. M煤ltiples modelos ML (ARIMA, Prophet, LSTM)
    5. An谩lisis de estacionalidad
    
    ###  ANLISIS ESTADSTICO (5 mejoras)
    6. Correlaciones entre categor铆as
    7. An谩lisis temporal (mes actual vs anterior)
    8. Clustering autom谩tico de gastos
    9. Detecci贸n de tendencias
    10. Identificaci贸n de outliers (IQR + Z-Score)
    
    ###  RECOMENDACIONES DE AHORRO (5 mejoras)
    11. Metas de ahorro (objetivos espec铆ficos)
    12. Tips personalizados (basados en patrones)
    13. Alertas de presupuesto (l铆mites mensuales)
    14. Gamificaci贸n (puntuaci贸n financiera)
    15. Reportes autom谩ticos (resumen semanal)
    
    ###  GRFICOS Y VISUALIZACIN (5 mejoras)
    16. Calendario de calor (Heatmap de gastos)
    17. Gr谩fico Sankey (Flujo de dinero)
    18. Dashboard interactivo (Panel con filtros)
    19. Comparativas (Mes vs mes anterior)
    20. Exportar como imagen (PNG/PDF)
    
    ##  Autenticaci贸n
    
    Todos los endpoints (excepto `/auth/token` y `/health`) requieren autenticaci贸n mediante JWT.
    
    **Paso 1:** Obtener token en `/api/v2/auth/token`
    
    **Paso 2:** Incluir token en headers:
    - `Authorization: Bearer {token}` o
    - `X-API-Key: {token}`

servers:
  - url: https://api-google-colab.onrender.com
    description: Servidor de producci贸n (Render)
  - url: http://localhost:5000
    description: Servidor de desarrollo local

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

paths:
  # ===== AUTENTICACIN =====
  /api/v2/auth/token:
    post:
      tags:
        - Autenticaci贸n
      summary: Generar token JWT
      description: |
        Genera un token de autenticaci贸n JWT v谩lido por 24 horas.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
              properties:
                user_id:
                  type: string
                  example: "abc123xyz789"
      responses:
        '200':
          description: Token generado exitosamente
          content:
            application/json:
              schema:
                type: object
                example:
                  status: "success"
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user_id: "abc123xyz789"

  # ===== PREDICCIN PERSONALIZADA =====
  /api/v2/users/{usuario_id}/predict-category:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Predicci贸n de categor铆a (filtrada)
      description: |
        Predicci贸n de gastos por categor铆a espec铆fica.
        
        **Datos en Firebase:**
        ```json
        {
          "fecha": "2024-12-20",
          "monto": 85.50,
          "categoria": "Comida"
        }
        ```
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          example: "user123"
        - name: category
          in: query
          required: false
          schema:
            type: string
          example: "Comida"
      responses:
        '200':
          description: Predicci贸n exitosa
          content:
            application/json:
              schema:
                type: object
                example:
                  status: "success"
                  usuario_id: "user123"
                  categoria: "Comida"
                  data:
                    prediccion_proximos_30_dias: 2550.75
                    gasto_promedio_diario: 85.03
                    tendencia: "estable"
        '400':
          description: Sin datos en Firebase
        '500':
          description: Error en predicci贸n

  /api/v2/users/{usuario_id}/predict-monthly:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Predicci贸n mensual (filtrada)
      description: |
        Predicci贸n de gastos mensuales (30 d铆as).
        
        **Datos en Firebase:**
        ```json
        {
          "fecha": "2024-12-18",
          "monto": 45.00,
          "categoria": "Transporte"
        }
        ```
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          example: "user456"
        - name: category
          in: query
          required: false
          schema:
            type: string
          example: "Transporte"
      responses:
        '200':
          description: Predicci贸n mensual exitosa
          content:
            application/json:
              schema:
                type: object
                example:
                  status: "success"
                  usuario_id: "user456"
                  categoria: "Transporte"
                  data:
                    prediccion_mes: 1350.00
                    semanas:
                      - semana: 1
                        estimado: 337.50
                      - semana: 2
                        estimado: 337.50
                      - semana: 3
                        estimado: 337.50
                      - semana: 4
                        estimado: 337.50
        '400':
          description: Sin datos en Firebase

  /api/v2/users/{usuario_id}/detect-anomalies:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: Detecci贸n de anomal铆as (filtrada)
      description: |
        Detecta gastos an贸malos o inusuales.
        
        **Datos en Firebase:**
        ```json
        {
          "fecha": "2024-12-25",
          "monto": 250.00,
          "categoria": "Entretenimiento"
        }
        ```
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          example: "user789"
        - name: category
          in: query
          required: false
          schema:
            type: string
          example: "Entretenimiento"
      responses:
        '200':
          description: An谩lisis de anomal铆as exitoso
          content:
            application/json:
              schema:
                type: object
                example:
                  status: "success"
                  usuario_id: "user789"
                  categoria: "Entretenimiento"
                  data:
                    anomalias_detectadas: 2
                    gastos_atipicos:
                      - fecha: "2024-12-25"
                        monto: 500.00
                        razon: "Valor muy alto (3x promedio)"
                      - fecha: "2024-12-10"
                        monto: 750.00
                        razon: "Valor at铆pico detectado"
                    umbral_deteccion: 150.00
        '400':
          description: Sin datos en Firebase

  /api/v2/users/{usuario_id}/analysis-complete:
    get:
      tags:
        -  Predicci贸n Personalizada
      summary: An谩lisis completo personalizado
      description: |
        An谩lisis completo: predicci贸n, anomal铆as, comparaci贸n de modelos y estacionalidad.
        
        **Datos en Firebase:**
        ```json
        {
          "fecha": "2024-12-22",
          "monto": 120.50,
          "categoria": "Compras"
        }
        ```
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
          example: "user999"
        - name: category
          in: query
          required: false
          schema:
            type: string
          example: "Compras"
      responses:
        '200':
          description: An谩lisis completo exitoso
          content:
            application/json:
              schema:
                type: object
                example:
                  status: "success"
                  usuario_id: "user999"
                  categoria: "Compras"
                  data:
                    prediccion_categoria:
                      prediccion_proximos_30_dias: 3600.00
                    prediccion_mensual:
                      estimado_mes: 3600.00
                      por_semana: 900.00
                    anomalias:
                      detectadas: 1
                      gastos_atipicos:
                        - monto: 1500.00
                          razon: "Compra grande detectada"
                    comparacion_modelos:
                      mejor_modelo: "Prophet"
                      precision: 0.87
                    estacionalidad:
                      patron: "Semanal"
                      picos_dias: ["viernes", "s谩bado"]
                    timestamp: "2026-02-05T15:30:45.123456"
        '400':
          description: Sin datos en Firebase
        '500':
          description: Error en el an谩lisis

  # ===== FIREBASE INTEGRATION =====
  /api/v2/firebase/users/{usuario_id}/gastos:
    get:
      tags:
        -  Firebase Integration
      summary: Obtener gastos del usuario
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Gastos obtenidos exitosamente
    
    post:
      tags:
        -  Firebase Integration
      summary: Crear nuevo gasto
      parameters:
        - name: usuario_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                monto:
                  type: number
                categoria:
                  type: string
                fecha:
                  type: string
              example:
                fecha: "2024-12-20"
                monto: 85.50
                categoria: "Comida"
      responses:
        '201':
          description: Gasto creado exitosamente

  /api/v2/firebase/debug:
    get:
      tags:
        -  Debug & Utilidades
      summary: Debug de Firebase
      security: []
      responses:
        '200':
          description: Informaci贸n de debug